process REPROD={
 
 untracked PSet maxEvents = {untracked int32 input = 5}
    service = MessageLogger {
        untracked vstring destinations = { "msms.log" }
        untracked PSet msms.log = { untracked string threshold = "DEBUG"  }
    }
    source = PoolSource
    {
        untracked vstring fileNames ={
     'file:oldtracks.root'
        }
    }
 
 
  
    module secondClusters = RemainingClusterProducer{
        InputTag matchedRecHits    = siStripMatchedRecHits:matchedRecHit
        InputTag rphirecHits       = siStripMatchedRecHits:rphiRecHit
        InputTag stereorecHits     = siStripMatchedRecHits:stereoRecHit
        InputTag pixelHits         = siPixelRecHits:
        InputTag recTracks         = ctfWithMaterialTracks:
        double DistanceCut         = 0.1
	
    }
    
    
 
    module secondPixelRecHits = SiPixelRecHitConverter {
	InputTag src = secondClusters:
	untracked string ClusterCollLabel   = "test"
	string CPE                = "Initial"
	double TanLorentzAnglePerTesla = 0.106
	untracked int32  VerboseLevel       = 0
	bool  Alpha2Order = true
    }
    
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"
    include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"
    include "RecoTracker/GeometryESProducer/data/TrackerRecoGeometryESProducer.cfi"
    
    include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEParmError.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/StripCPEfromTrackAngle.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitMatcher.cfi"
    include "RecoLocalTracker/SiStripRecHitConverter/data/SiStripRecHitConverter.cfi"
    
    include "TrackingTools/MaterialEffects/data/MaterialPropagator.cfi"
    include "TrackingTools/MaterialEffects/data/OppositeMaterialPropagator.cfi"
    include "TrackingTools/TrackFitters/data/KFTrajectoryFitterESProducer.cfi"
    include "TrackingTools/TrackFitters/data/KFTrajectorySmootherESProducer.cfi"
    include "TrackingTools/TrackFitters/data/KFFittingSmootherESProducer.cfi"
    include "TrackingTools/KalmanUpdators/data/KFUpdatorESProducer.cfi"
    include "TrackingTools/KalmanUpdators/data/Chi2MeasurementEstimatorESProducer.cfi"
    
    include "RecoTracker/TransientTrackingRecHit/data/TransientTrackingRecHitBuilder.cfi"
    include "RecoTracker/CkfPattern/data/CkfTrajectoryBuilderESProducer.cfi"
    replace CkfTrajectoryBuilder.ptCut=0.7
    include "RecoTracker/MeasurementDet/data/MeasurementTrackerESProducer.cfi"
    replace MeasurementTracker.pixelClusterProducer ="secondClusters"
    replace MeasurementTracker.stripClusterProducer ="secondClusters"
    
 
    module secondStripRecHits = SiStripRecHitConverter{
	untracked int32 VerbosityLevel = 1
	string ClusterProducer = "secondClusters"
	string StripCPE = "StripCPEfromTrackAngle"
	string Matcher = "StandardMatcher"
	string matchedRecHits = "matchedRecHit"
	string rphiRecHits = "rphiRecHit"
	string stereoRecHits = "stereoRecHit"
 }
    
    module secondMixedSeeds = GlobalMixedSeedGenerator{
	
        string PixelHitProducer = "secondPixelRecHits"
        InputTag matchedRecHits = secondStripRecHits:matchedRecHit
        InputTag rphiRecHits    = secondStripRecHits:rphiRecHit
        InputTag stereoRecHits  = secondStripRecHits:stereoRecHit
        double ptMin=0.7
        double originRadius=0.2
        double originHalfLength=15
        double originZPosition=0
        string TTRHBuilder        =  "WithTrackAngle"
 
    }
    
    module secondTrackCandidates = CkfTrackCandidateMaker
    {
     #bool   seedCleaning         = false
	string SeedProducer          = "secondMixedSeeds"
	string SeedLabel             = ""
	string TrajectoryBuilder     = "CkfTrajectoryBuilder"
      
	## set it as "none" to avoid redundant seed cleaner
	string RedundantSeedCleaner  = "CachingSeedCleanerBySharedInput"
	#string RedundantSeedCleaner  = "none"
	
	# nested parameter set for TransientInitialStateEstimator
	PSet TransientInitialStateEstimatorParameters =
	{
	    string propagatorAlongTISE    = "PropagatorWithMaterial"
	    string propagatorOppositeTISE = "PropagatorWithMaterialOpposite"
      }
	
    }
    
    module secondWithMaterialTracks = TrackProducer
    {
	string Fitter = "KFFittingSmoother"
	string Propagator = "PropagatorWithMaterial"
	string src = "secondTrackCandidates"
	string producer = ""
	string TTRHBuilder       =   "WithTrackAngle"
	bool TrajectoryInEvent = true
    }
    
 
    module out = PoolOutputModule {
        untracked string fileName = 'newclusters.root'
	
    }
    
    path p ={
	secondClusters
	,secondPixelRecHits
	,secondStripRecHits
	#	,secondMixedSeeds
	#	,secondTrackCandidates
	#	,secondWithMaterialTracks
    }

 
    endpath outpath = { out }
}
